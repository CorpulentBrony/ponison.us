!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";!function(){const e="//api.ponison.us/index.php",t={buttonGetAudio:void 0,divSoundTypes:void 0,fieldsetTiming:void 0,inputDesiredLengthSeconds:void 0,inputMaxDelaySeconds:void 0,inputMinDelaySeconds:void 0,inputSelectAll:void 0,outputAudio:void 0,scriptList:void 0,selectOutputFormat:void 0,selectPonies:void 0,templateOutputAudio:void 0,templateSoundType:void 0},n=new window.Promise(e=>{"loading"===window.document.readyState?window.document.addEventListener("DOMContentLoaded",e,!1):e()}),o=new window.Map;let i=void 0;function d(){const n=JSON.stringify({requestType:"audio",desiredLengthSeconds:window.Number(t.inputDesiredLengthSeconds.value),maxDelaySeconds:window.Number(t.inputMaxDelaySeconds.value),minDelaySeconds:window.Number(t.inputMinDelaySeconds.value),outputFormat:t.selectOutputFormat.value,ponies:[t.selectPonies.value],soundTypes:Array.prototype.reduce.call(i,(e,t)=>(t.checked&&e.push(t.value),e),new window.Array)});window.fetch(e,{body:n,headers:{"Content-Type":"application/json"},method:"POST"}).then(e=>e.json()).then(r).then(p).catch(console.error)}function r(e){if(!e)throw"Could not parse response or an empty response received";if("error"===e.responseType)throw e.response;return e}function u(e,t={},n,o){const i=window.document.createElement(e);return h(i,t),void 0!==o&&(i.textContent=o),void 0!==n&&n.appendChild(i),i}function s(){!function(){const e=Array.prototype.filter.call(i,e=>e.checked);let n;n=e.length===i.length?{checked:!0,indeterminate:!1}:e.length>0?{checked:!1,indeterminate:!0}:{checked:!1,indeterminate:!1};window.Object.assign(t.inputSelectAll,n)}()}function c(){t.inputDesiredLengthSeconds.poni_checkValue(),h(t.inputMinDelaySeconds,{max:t.inputDesiredLengthSeconds.value,maxlength:String(t.inputDesiredLengthSeconds.value).length+2}),t.inputMinDelaySeconds.setAttribute("max",t.inputDesiredLengthSeconds.value),t.inputMinDelaySeconds.poni_checkValue(),h(t.inputMaxDelaySeconds,{max:t.inputDesiredLengthSeconds.value,maxlength:String(t.inputDesiredLengthSeconds.value).length+2,min:t.inputMinDelaySeconds.value}),t.inputMaxDelaySeconds.poni_checkValue()}function a(){const e=r(window.JSON.parse(t.scriptList.textContent));if(!window.Array.isArray(e.response)||0===e.response.length)throw"Received an invalid response";const n=window.document.createDocumentFragment();e.response.forEach(e=>{const i=window.document.createDocumentFragment();u("option",{},n,e.name),e.soundTypes.forEach(function(e,n,o){const i=`input-${o.name.toLowerCase()}`,d=t.templateSoundType.content.cloneNode(!0),r=d.querySelector("input"),s=d.querySelector("label");[r.id,r.value]=[i,o.name],s.setAttribute("for",i),s.textContent=`${o.name} (`,u("a",{href:window.encodeURI(`/pony/${n}/${o.name}/`),target:"_blank",type:"text/html"},s,o.numberAvailable),s.appendChild(window.document.createTextNode(")")),e.appendChild(d)}.bind(void 0,i,e.name)),o.set(e.name,i)}),t.selectPonies.appendChild(n),y();const i=window.document.createDocumentFragment();for(const t in e.requestProperties.validOutputFormats)u("option",{},i,t);t.selectOutputFormat.appendChild(i),h(t.inputDesiredLengthSeconds,{max:e.requestProperties.maxDesiredLengthSeconds,maxlength:String(e.requestProperties.maxDesiredLengthSeconds).length,min:e.requestProperties.minDesiredLengthSeconds}),t.inputMinDelaySeconds.setAttribute("min",e.requestProperties.minDelaySeconds)}function l(){i.forEach(e=>e.checked=t.inputSelectAll.checked)}async function p(e){e=e.response,console.log(e);const n=await window.fetch(e.outputFile.url).then(e=>e.blob()),o=window.URL.createObjectURL(n),i=`PoniSonus ${t.selectPonies.value} ${window.Math.floor(16777216*(window.Math.random()+1)).toString(32).substring(1)}.${t.selectOutputFormat.value}`,d=t.templateOutputAudio.content.cloneNode(!0),r=d.querySelector("video");try{r.srcObject=n}catch(e){r.src=o}d.querySelector("track").setAttribute("src",window.URL.createObjectURL(new window.Blob([e.timingLog],{type:"text/vtt"}))),h(d.querySelector("a"),{download:i,href:o}),h(d.getElementById("time-duration"),{datetime:`PT${e.outputFile.durationSeconds}S`,textContent:`${e.outputFile.durationSeconds} seconds`}).removeAttribute("id"),h(d.getElementById("data-size"),{textContent:`${e.outputFile.sizeBytes} bytes`,value:e.outputFile.sizeBytes}).removeAttribute("id"),h(d.getElementById("time-lifetime"),{datetime:`PT${e.outputFile.lifetimeSeconds}S`,textContent:`${e.outputFile.lifetimeSeconds} seconds`}).removeAttribute("id"),h(d.getElementById("time-processing"),{datetime:`PT${e.generationTimeElapsedSeconds}S`,textContent:`${e.generationTimeElapsedSeconds} seconds`}).removeAttribute("id"),h(d.getElementById("data-used-sound-types"),{textContent:`${e.numberSoundTypesUsed} sound types`,value:e.numberSoundTypesUsed}).removeAttribute("id"),h(d.getElementById("data-total-sound-types"),{textContent:String(e.totalSoundTypesSelected),value:e.totalSoundTypesSelected}).removeAttribute("id");const u=e.numberSoundTypesUsed/e.totalSoundTypesSelected;h(d.getElementById("data-percent-of-total"),{textContent:`${Number(100*u).toFixed(2)}%`,value:u}).removeAttribute("id"),d.querySelector("code").textContent=JSON.stringify(e),m(t.outputAudio).appendChild(d)}function m(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}function y(){m(t.divSoundTypes).appendChild(o.get(t.selectPonies.value).cloneNode(!0)),t.inputSelectAll.checked=!0}function h(e,t={}){for(const n in t)"textContent"===n?e.textContent=t[n]:e.setAttribute(n,t[n]);return e}(async function(){await n;for(const e in t)t[e]=window.document.getElementById(e.replace(/([A-Z])/g,e=>`-${e[0].toLowerCase()}`));t.inputDesiredLengthSeconds.poni_checkValue=t.inputMinDelaySeconds.poni_checkValue=t.inputMaxDelaySeconds.poni_checkValue=function(){this.value=window.Math.min(window.Math.max(Number(this.value),Number(this.min)),Number(this.max))},a(),i=t.divSoundTypes.querySelectorAll("input"),t.buttonGetAudio.addEventListener("click",d,!1),t.divSoundTypes.addEventListener("change",s,!1),t.fieldsetTiming.addEventListener("change",c,!1),t.inputSelectAll.addEventListener("change",l,!1),t.selectPonies.addEventListener("change",y,!1)})().catch(console.error)}()}]);
//# sourceMappingURL=index.js.map